## spring 事务- 声明式事件 - 配置事务管理器 DataSourceTransactionManager - 启用事务管理 transaction-manager - 添加事件注解 Transactional ```xml     <!-- 配置事务管理器 -->    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">        <property name="dataSource" ref="dataSource" />    </bean>    <!-- 启用事务管理 -->    <tx:annotation-driven transaction-manager="transactionManager" />```## 事件的传播行为- 当一个事务方法被另一个事务方法调用时，必须指定事务应该如何传播- 事务的传播行为可以由传播属性指定：spring 定义了 7 种类传播行为 - 使用 propagation 指定事件的传播行为 - Propagation.REQUIRED, 即使用外事务。 - REQUIRES_NEW， 即使用内事务，外事务挂起 ## 事务的隔离级别* 1.使用 propagation 指定事务的传播行为，即当前事务方法被别处一个事务方法调用时     *  如何使用事务，默认取值为 REQUIRED， 即使用调用方法的事务     *  REQUIRES_NEW：事务自己的事务，调用的事务方法的事务被挂起。     *  2. 使用 isolation 指定事务的隔离级别， 最常用的取值为事务READ_COMMITTED     *  3.默认情况下 spring 的声明式事务所有的运行时异常进行回滚，也可以通过对应的属性进行设置，通常情况下去默认值即可。     *  4.使用 readOnly 指定指定事务的是否为只读， 表示这个事务只读取数据但不更新数据 ，     *  这样可以帮助数据库引擎优化事务， 若真的事一个只读取数据库值的方法， 应设置 readOnly = true     *  5.使用 timiout 指定强制回滚之前事务可以占用的赶时间          ## xml形式配置事务- 步骤： - 1.配置事务管理器 - 2.配置事务属性 - 3.配置事务切入点，把事务切入点和事务属性关联起来  ```xml      <!-- 配置事务管理器 -->     <bean id="tranactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">         <property name="dataSource" ref="dataSource" />     </bean>      <!-- 配置事务属性 -->     <tx:advice id="txAdvice" transaction-manager="tranactionManager">         <tx:attributes>             <tx:method name="purchase" propagation="REQUIRES_NEW"/>          </tx:attributes>     </tx:advice>       <!-- 配置事务切入点，把事务切入点和事务属性关联越来 -->     <aop:config>         <aop:pointcut id="txPointCut" expression="execution(* aqqje.com.jdbc.txxml.services.BookStockService.*(..))"/>         <aop:advisor advice-ref="txAdvice" pointcut-ref="txPointCut"/>     </aop:config> ```  ## Spring 如何在 WEB 应用使用? -  1) 需要外加的 jar 包: - spring-web-xxx.RELEASE.jar - spring-webmvc-xxx.RELEASE.jar- 2) spring 的配置文件不变- 3) 如何创建 IoC 容器? - a 非 WEB 应用在 main 方法中直接创建 - b 应该在 WEB 应用被服务器加载时就创建 IoC 容器:        在 ServletContextListener#contextInitalized(ServletContextExvent sce) 方法中创建 - c  在 WEB 应用的其他组件中如何来访问 IoC 容器?       在 ServletContextListener#contextInitalized(ServletContextExvent sce) 方法中创建后,       可以把其在 ServletContext(即 application 域)的一个属性中 - d 实际上, spring 配置文件的名字和位置应该也是可以配置的! 将其配置到时当前 WEB 应用的初始化参数中较为合适- 4) 在 WEB 环境下使用 spring  - 需要在 web.xml 文件中加入如下配置:  ```xml  <!-- 配置 Spring 配置文件的名称和位置 --> <context-param> 	<param-name>contextConfigLocation</param-name> 	<param-value>classpath:applicationContext.xml</param-value> </context-param>  <!-- 启动 IOC 容器的 ServletContextListener --> <listener> 	<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class> </listener> ```      