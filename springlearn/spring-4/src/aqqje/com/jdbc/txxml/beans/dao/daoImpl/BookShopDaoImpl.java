/** * Copyright (c), 2018-2018, XXX有限公司 * FileName: BookShopDaoImpl * Author:   Administrator * Date:     2018/5/1022:57 * Description: * History: * <author>    <time>    <version>    <desc> * 作者姓名     修改时间      版本号       描述 */package aqqje.com.jdbc.txxml.beans.dao.daoImpl;import aqqje.com.jdbc.txxml.beans.dao.BookShopDao;import aqqje.com.jdbc.txxml.exception.BalanceException;import aqqje.com.jdbc.txxml.exception.BookStockException;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.jdbc.core.JdbcTemplate;import org.springframework.stereotype.Repository;public class BookShopDaoImpl implements BookShopDao {    private JdbcTemplate jdbcTemplate;    public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {        this.jdbcTemplate = jdbcTemplate;    }    @Override    public double findPriceByisbn(Integer isbn) {        String sql = "SELECT price FROM book WHERE isbn = ?";        return jdbcTemplate.queryForObject(sql, Integer.class, isbn);    }    @Override    public void updataStock(Integer isbn) {        // 判断库存是否为 0        String sql2 = "SELECT stock FROM book_stock WHERE isbn = ?";        int stock = jdbcTemplate.queryForObject(sql2, Integer.class, isbn);        if(stock <= 0){            throw new BookStockException("库存不足！");        }        String sql = "UPDATE book_stock SET stock = stock - 1 WHERE isbn = ?";        jdbcTemplate.update(sql, isbn);    }    @Override    public void updataBalance(String username, double price) {        String sql2 = "SELECT balance FROM account WHERE username = ?";        double balace = jdbcTemplate.queryForObject(sql2, Double.class, username);        if(balace < price){            throw new BalanceException("余额不足！");        }        String sql = "UPDATE account SET balance = balance - ? WHERE username = ?";        jdbcTemplate.update(sql, price, username);    }}